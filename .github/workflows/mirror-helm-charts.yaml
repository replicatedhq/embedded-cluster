name: Update Addons
# XXX change me
on:
- pull_request

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    - name: Check out repo
      uses: actions/checkout@v4
    - name: Set up Go
      uses: actions/setup-go@v5
      with:
        go-version-file: go.mod
    - name: Compile buildtools
      run: |
        make buildtools
  update-dependencies:
    runs-on: ubuntu-latest
    needs:
    - build
    strategy:
      fail-fast: false
      matrix:
        addon:
        - openebs
        - registry
        - seaweedfs
        - velero
    steps:
    - name: Update ${{ matrix.addon }}
      id: update
      env:
        DESTINATION: oci://ttl.sh/embedded-cluster-charts
      run: |
        ./output/bin/buildtools update --force addon ${{ matrix.addon }}
